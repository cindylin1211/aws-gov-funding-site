<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆå§‹åŒ– Supabase è³‡æ–™åº«</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #FF9900;
            padding-bottom: 10px;
        }
        button {
            background: #FF9900;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px 0;
        }
        button:hover {
            background: #EC7211;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 16px;
        }
        .status.info {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
        }
        .status.success {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
        }
        .status.error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .status.warning {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #FF9900;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ åˆå§‹åŒ– Supabase è³‡æ–™åº«</h1>
        
        <div class="status info">
            <strong>ğŸ“‹ èªªæ˜ï¼š</strong><br>
            é€™å€‹å·¥å…·æœƒå°‡ 31 å€‹è£œåŠ©è¨ˆç•«ä¸Šå‚³åˆ° Supabase è³‡æ–™åº«ã€‚<br>
            è«‹ç¢ºä¿æ‚¨å·²ç¶“ï¼š
            <ul>
                <li>âœ… å»ºç«‹äº† Supabase å°ˆæ¡ˆ</li>
                <li>âœ… åŸ·è¡Œäº† supabase-setup.sql å»ºç«‹è³‡æ–™è¡¨</li>
                <li>âœ… æœ‰ç¶²è·¯é€£ç·š</li>
            </ul>
        </div>

        <button id="initBtn" onclick="initializeDatabase()">
            é–‹å§‹åˆå§‹åŒ–è³‡æ–™åº«
        </button>

        <div id="statusDiv"></div>

        <div class="step">
            <h3>ğŸ“ åˆå§‹åŒ–å¾Œçš„æ­¥é©Ÿï¼š</h3>
            <ol>
                <li>ç¢ºèªåˆå§‹åŒ–æˆåŠŸï¼ˆçœ‹åˆ°ç¶ è‰²æˆåŠŸè¨Šæ¯ï¼‰</li>
                <li>å°‡å°ˆæ¡ˆéƒ¨ç½²åˆ° AWS Amplify</li>
                <li>è¨ªå• /admin é é¢æ¸¬è©¦ç·¨è¼¯åŠŸèƒ½</li>
                <li>ç¢ºèªä¸»ç¶²ç«™èƒ½åœ¨ 5 ç§’å…§çœ‹åˆ°æ›´æ–°</li>
            </ol>
        </div>
    </div>

    <script type="module">
        async function initializeDatabase() {
            const btn = document.getElementById('initBtn');
            const statusDiv = document.getElementById('statusDiv');
            
            btn.disabled = true;
            btn.textContent = 'åˆå§‹åŒ–ä¸­...';
            
            try {
                // é¡¯ç¤ºé€²åº¦
                statusDiv.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨è®€å–è£œåŠ©è³‡æ–™...</div>';
                
                // è®€å– JSON è³‡æ–™
                const response = await fetch('./public/grants-database.json');
                if (!response.ok) {
                    throw new Error('ç„¡æ³•è®€å– grants-database.json');
                }
                const data = await response.json();
                const grants = data.grants;
                
                statusDiv.innerHTML = `<div class="status info">ğŸ“Š æ‰¾åˆ° ${grants.length} å€‹è£œåŠ©è¨ˆç•«<br>ğŸ”Œ æ­£åœ¨é€£æ¥ Supabase...</div>`;
                
                // å‹•æ…‹è¼‰å…¥ Supabase
                const { createClient } = await import('https://esm.sh/@supabase/supabase-js@2');
                
                const supabase = createClient(
                    'https://uijhsmfimsscmfycsrhr.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVpamhzbWZpbXNzY21meWNzcmhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NDU3OTAsImV4cCI6MjA3NDEyMTc5MH0.RRkluAiZtnJU_AquD6rQnQeslaNC2MlzXPYdWcJwSRs'
                );
                
                statusDiv.innerHTML = `<div class="status info">ğŸ“Š æ‰¾åˆ° ${grants.length} å€‹è£œåŠ©è¨ˆç•«<br>ğŸ”Œ å·²é€£æ¥ Supabase<br>ğŸ“¤ æ­£åœ¨ä¸Šå‚³è³‡æ–™...</div>`;
                
                // ä¸Šå‚³è³‡æ–™
                const { data: result, error } = await supabase
                    .from('grants')
                    .upsert({
                        id: 'grants-data',
                        data: grants,
                        updated_at: new Date().toISOString()
                    }, {
                        onConflict: 'id'
                    });
                
                if (error) {
                    throw error;
                }
                
                // æˆåŠŸ
                statusDiv.innerHTML = `
                    <div class="status success">
                        <strong>âœ… åˆå§‹åŒ–æˆåŠŸï¼</strong><br><br>
                        å·²æˆåŠŸä¸Šå‚³ ${grants.length} å€‹è£œåŠ©è¨ˆç•«åˆ° Supabase<br><br>
                        <strong>ä¸‹ä¸€æ­¥ï¼š</strong><br>
                        1. å°‡å°ˆæ¡ˆéƒ¨ç½²åˆ° AWS Amplify<br>
                        2. è¨ªå• /admin é é¢æ¸¬è©¦ç·¨è¼¯åŠŸèƒ½<br>
                        3. ç¢ºèªä¸»ç¶²ç«™é¡¯ç¤ºæ­£ç¢º
                    </div>
                `;
                
                btn.textContent = 'âœ… åˆå§‹åŒ–å®Œæˆ';
                btn.style.background = '#4CAF50';
                
            } catch (error) {
                console.error('éŒ¯èª¤:', error);
                statusDiv.innerHTML = `
                    <div class="status error">
                        <strong>âŒ åˆå§‹åŒ–å¤±æ•—</strong><br><br>
                        éŒ¯èª¤è¨Šæ¯ï¼š${error.message}<br><br>
                        <strong>å¯èƒ½çš„åŸå› ï¼š</strong><br>
                        â€¢ ç¶²è·¯é€£ç·šå•é¡Œ<br>
                        â€¢ Supabase è³‡æ–™è¡¨å°šæœªå»ºç«‹ï¼ˆè«‹å…ˆåŸ·è¡Œ supabase-setup.sqlï¼‰<br>
                        â€¢ API Key éŒ¯èª¤<br><br>
                        <strong>æ›¿ä»£æ–¹æ¡ˆï¼š</strong><br>
                        è«‹åƒè€ƒ DEPLOYMENT_INSTRUCTIONS.md ä¸­çš„å…¶ä»–åˆå§‹åŒ–æ–¹å¼
                    </div>
                `;
                
                btn.disabled = false;
                btn.textContent = 'é‡è©¦';
            }
        }
        
        // å°‡å‡½æ•¸æš´éœ²åˆ°å…¨åŸŸ
        window.initializeDatabase = initializeDatabase;
    </script>
</body>
</html>
