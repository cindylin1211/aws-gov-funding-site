# Implementation Plan

此實作計畫涵蓋政府補助計畫搜尋器的核心功能開發。系統已完成基礎架構，以下任務用於追蹤未來的功能增強和維護工作。

## 已完成的核心功能

以下功能已在現有系統中實作：
- ✅ 基礎專案架構（React + TypeScript + Vite）
- ✅ 補助資料型別定義
- ✅ 資料載入和管理 Hook
- ✅ 搜尋功能
- ✅ 多維度篩選功能
- ✅ 排序功能
- ✅ 補助卡片顯示
- ✅ 詳細資訊彈窗
- ✅ 響應式設計
- ✅ 載入和錯誤狀態處理

## 待實作任務

### 0. 企業規模多重選取功能

- [ ] 0.1 更新篩選狀態結構
  - 修改 Filters 介面將 companySize 從 string 改為 string[]
  - 更新 useGrantsData Hook 中的初始狀態
  - 更新篩選邏輯以支援陣列比對
  - _Requirements: 2.6, 2.7, 2.8, 2.9_

- [ ] 0.2 更新 FilterSection 組件
  - 修改企業規模按鈕的點擊處理邏輯以支援多選
  - 實作切換選取狀態的功能（點擊已選取的按鈕會取消選取）
  - 更新視覺樣式以清楚顯示多個選取狀態
  - 確保多個按鈕可以同時處於選取狀態
  - _Requirements: 2.6, 2.7, 2.8, 2.10_

- [ ] 0.3 更新篩選邏輯
  - 修改 useGrantsData Hook 中的 companySize 篩選邏輯
  - 實作 OR 邏輯：顯示符合任一選取企業規模的補助計畫
  - 檢查補助計畫的企業規模陣列與選取的企業規模陣列是否有交集
  - _Requirements: 2.9_

- [ ] 0.4 測試多重選取功能
  - 測試單一企業規模選取
  - 測試多個企業規模同時選取
  - 測試取消選取功能
  - 測試與其他篩選條件的組合
  - 驗證篩選結果正確性
  - _Requirements: 2.6, 2.7, 2.8, 2.9, 2.10_

## 功能增強任務

### 1. 資料管理工具

- [ ] 1.1 建立資料驗證工具
  - 建立 dataValidator.ts 工具模組
  - 實作必填欄位驗證函式
  - 實作 URL 格式驗證
  - 實作日期格式驗證
  - 實作金額格式驗證
  - 實作分類對應關係驗證
  - 建立 ValidationResult 型別定義
  - _Requirements: 12.1, 12.2, 12.3, 12.4, 12.5, 12.6, 12.7, 12.8_

- [ ] 1.2 建立檔案解析工具
  - 建立 fileParser.ts 工具模組
  - 實作 CSV 檔案解析功能（使用 papaparse）
  - 實作 Excel 檔案解析功能（使用 xlsx）
  - 實作資料範本生成功能
  - 處理檔案讀取錯誤
  - _Requirements: 11.1, 11.2, 11.3_

- [ ] 1.3 建立資料匯出工具
  - 建立 dataExporter.ts 工具模組
  - 實作 JSON 匯出功能
  - 實作 CSV 匯出功能
  - 實作 Excel 匯出功能
  - 處理瀏覽器下載功能
  - _Requirements: 10.10_

- [ ] 1.4 建立資料管理 Hook
  - 建立 useDataManagement.ts Hook
  - 實作新增補助計畫功能
  - 實作更新補助計畫功能
  - 實作刪除補助計畫功能
  - 實作批次匯入功能
  - 實作資料匯出功能
  - 實作分類統計重新計算
  - 整合資料驗證
  - _Requirements: 10.3, 10.5, 10.6, 10.7, 10.8, 10.9, 11.5, 11.6_

- [ ] 1.5 建立補助計畫表單組件
  - 建立 GrantForm.tsx 組件
  - 實作所有欄位的輸入控制項
  - 實作表單驗證和錯誤顯示
  - 實作新增和編輯模式
  - 實作表單提交和取消處理
  - 加入即時驗證回饋
  - _Requirements: 10.3, 10.4, 10.5, 10.6, 12.7_

- [ ] 1.6 建立補助計畫列表組件
  - 建立 GrantList.tsx 組件
  - 實作資料表格顯示
  - 加入搜尋和篩選功能
  - 實作編輯和刪除按鈕
  - 實作刪除確認對話框
  - 加入分頁功能
  - _Requirements: 10.2, 10.6, 10.8_

- [ ] 1.7 建立匯入對話框組件
  - 建立 ImportDialog.tsx 組件
  - 實作檔案上傳介面
  - 實作範本下載功能
  - 顯示匯入預覽表格
  - 實作資料驗證和錯誤顯示
  - 顯示匯入結果報告
  - _Requirements: 11.1, 11.2, 11.3, 11.4, 11.5, 11.6, 11.7_

- [ ] 1.8 建立管理頁面
  - 建立 Admin.tsx 頁面
  - 整合 GrantList 組件
  - 整合 GrantForm 組件
  - 整合 ImportDialog 組件
  - 實作新增按鈕和對話框
  - 實作匯入按鈕和對話框
  - 實作匯出功能按鈕
  - 加入頁面路由保護（可選）
  - _Requirements: 10.1, 10.2, 10.3, 10.7, 10.10_

- [ ] 1.9 整合到主應用程式
  - 在路由中加入 /admin 路徑
  - 建立管理介面導航連結
  - 測試資料管理功能
  - 確保資料變更即時反映到前端
  - 測試資料驗證流程
  - _Requirements: 10.1, 10.7, 10.9_

- [ ]* 1.10 加入進階功能（選擇性）
  - 實作資料版本控制
  - 加入操作歷史記錄
  - 實作資料備份和還原
  - 加入多使用者權限管理
  - _Requirements: 10.7_

### 2. 線上政府補助小助手

- [ ] 2.1 建立小助手浮動按鈕組件
  - 建立 ChatAssistant.tsx 組件
  - 實作固定在右下角的浮動按鈕
  - 加入圖示（使用 MessageCircle 或 Bot 圖示）
  - 實作 hover 和點擊動畫效果
  - 確保在所有裝置上的響應式顯示
  - _Requirements: 9.1, 9.2, 9.4, 9.5, 9.6_

- [ ] 2.2 建立聊天介面 UI
  - 建立聊天視窗組件
  - 實作訊息列表顯示
  - 建立訊息輸入框
  - 加入開啟/關閉動畫
  - 實作響應式聊天視窗大小
  - _Requirements: 9.3, 9.5_

- [ ] 2.3 整合到主頁面
  - 在 Index.tsx 中加入 ChatAssistant 組件
  - 確保不影響現有功能
  - 測試在不同螢幕尺寸下的顯示
  - 調整 z-index 確保正確的層級顯示
  - _Requirements: 9.1, 9.5, 9.6_

- [ ]* 2.4 整合 AI 聊天功能（選擇性）
  - 整合 OpenAI API 或其他 AI 服務
  - 實作訊息發送和接收邏輯
  - 加入打字指示器
  - 實作錯誤處理
  - _Requirements: 9.3_

### 3. 搜尋功能優化

- [ ] 3.1 實作模糊搜尋功能
  - 使用 Fuse.js 或類似函式庫實作模糊匹配
  - 調整搜尋權重（計畫名稱 > 補助重點 > 主辦單位）
  - 加入搜尋結果相關度排序
  - _Requirements: 1.1, 1.2_

- [ ] 3.2 加入搜尋建議功能
  - 實作搜尋關鍵字自動完成
  - 顯示熱門搜尋關鍵字
  - 儲存最近搜尋歷史（使用 localStorage）
  - _Requirements: 1.1_

- [ ] 3.3 加入進階搜尋選項
  - 建立進階搜尋 UI 組件
  - 支援多欄位組合搜尋
  - 加入搜尋運算子（AND、OR、NOT）
  - _Requirements: 1.1, 1.2_

### 4. 使用者體驗改善

- [ ] 4.1 實作我的最愛功能
  - 建立 Favorites 狀態管理
  - 在卡片上加入收藏按鈕
  - 使用 localStorage 持久化收藏資料
  - 建立我的最愛頁面或篩選選項
  - _Requirements: 3.1, 3.2_

- [ ] 4.2 加入補助計畫比較功能
  - 建立比較模式 UI
  - 允許選擇多個補助計畫（最多 3-4 個）
  - 建立並排比較視圖
  - 突顯關鍵差異（金額、對象、時程）
  - _Requirements: 3.1, 3.2, 8.1, 8.2_

- [ ] 4.3 實作結果匯出功能
  - 加入匯出按鈕到結果區域
  - 實作 PDF 匯出（使用 jsPDF）
  - 實作 Excel 匯出（使用 xlsx）
  - 包含篩選條件和結果摘要
  - _Requirements: 8.1, 8.2, 8.3_

### 5. 資料管理增強

- [ ] 5.1 建立資料驗證機制
  - 實作 JSON Schema 驗證
  - 在資料載入時驗證格式
  - 提供詳細的驗證錯誤訊息
  - 加入資料完整性檢查
  - _Requirements: 7.1, 7.2, 7.3_

- [ ] 5.2 加入資料更新通知
  - 實作版本檢查機制
  - 偵測 JSON 檔案更新
  - 顯示更新通知給使用者
  - 提供重新載入資料選項
  - _Requirements: 7.2, 7.4_

- [ ] 5.3 實作資料快取策略
  - 使用 Service Worker 快取資料
  - 實作離線存取功能
  - 加入快取更新邏輯
  - 顯示資料新鮮度指示
  - _Requirements: 7.1, 7.2_

### 6. 效能優化

- [ ] 6.1 實作虛擬滾動
  - 整合 react-window 或 react-virtual
  - 優化大量結果的渲染效能
  - 保持滾動位置狀態
  - _Requirements: 8.1, 8.2_

- [ ] 6.2 加入圖片延遲載入
  - 實作 Intersection Observer
  - 優化圖片載入時機
  - 加入載入佔位符
  - _Requirements: 5.1, 5.2_

- [ ] 6.3 優化打包大小
  - 分析 bundle 大小
  - 實作程式碼分割
  - 移除未使用的依賴
  - 優化 Tailwind CSS 輸出
  - _Requirements: 5.1, 5.2, 5.3_

### 7. 分析和追蹤

- [ ] 7.1 整合分析工具
  - 加入 Google Analytics 或類似工具
  - 追蹤頁面瀏覽和使用者行為
  - 設定自訂事件（搜尋、篩選、查看詳情）
  - _Requirements: 1.1, 2.1, 3.1_

- [ ] 7.2 實作使用統計儀表板
  - 建立統計資料收集機制
  - 顯示熱門補助計畫
  - 顯示常用篩選條件
  - 顯示搜尋趨勢
  - _Requirements: 1.1, 2.1, 6.1_

### 8. 無障礙功能改善

- [ ] 8.1 加強鍵盤導航
  - 實作完整的鍵盤快捷鍵
  - 改善 focus 管理
  - 加入跳過導航連結
  - 測試 Tab 順序
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 8.2 改善螢幕閱讀器支援
  - 加入適當的 ARIA 標籤
  - 改善語意化 HTML
  - 加入即時區域通知
  - 測試 NVDA/JAWS 相容性
  - _Requirements: 5.1, 5.2, 5.3_

- [ ]* 8.3 加入無障礙測試
  - 整合 axe-core 或 jest-axe
  - 建立無障礙測試套件
  - 加入 CI/CD 自動化測試
  - _Requirements: 5.1, 5.2, 5.3_

### 9. 國際化支援

- [ ] 9.1 建立多語言架構
  - 整合 react-i18next
  - 建立翻譯檔案結構
  - 實作語言切換功能
  - _Requirements: 5.1, 5.2_

- [ ] 9.2 翻譯 UI 文字
  - 翻譯所有介面文字為英文
  - 建立翻譯鍵值對照表
  - 實作動態語言載入
  - _Requirements: 5.1, 5.2_

- [ ] 9.3 支援多語言資料
  - 擴充 JSON 資料結構支援多語言
  - 實作語言切換時的資料更新
  - 處理混合語言內容
  - _Requirements: 7.1, 7.2_

### 10. 測試覆蓋率提升

- [ ]* 10.1 建立元件單元測試
  - 為 SearchBar 撰寫測試
  - 為 FilterSection 撰寫測試
  - 為 GrantCard 撰寫測試
  - 為 GrantModal 撰寫測試
  - _Requirements: 1.1, 2.1, 3.1, 3.2_

- [ ]* 10.2 建立 Hook 單元測試
  - 為 useGrantsData 撰寫完整測試
  - 測試篩選邏輯
  - 測試排序邏輯
  - 測試錯誤處理
  - _Requirements: 1.1, 2.1, 4.1, 7.3_

- [ ]* 10.3 建立整合測試
  - 測試完整使用者流程
  - 測試篩選組合效果
  - 測試排序與篩選互動
  - 測試資料載入和錯誤恢復
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 7.3_

- [ ]* 10.4 建立 E2E 測試
  - 使用 Playwright 或 Cypress
  - 測試關鍵使用者路徑
  - 測試跨瀏覽器相容性
  - 加入視覺回歸測試
  - _Requirements: 5.1, 5.2, 5.3_

### 11. SEO 和效能優化

- [ ] 11.1 實作 SSR 或 SSG
  - 評估遷移到 Next.js 或 Remix
  - 實作伺服器端渲染
  - 優化首次內容繪製時間
  - _Requirements: 5.1, 5.2_

- [ ] 11.2 加入結構化資料
  - 實作 JSON-LD 標記
  - 加入 Schema.org 標記
  - 優化社群媒體分享標籤
  - _Requirements: 5.1, 5.2_

- [ ] 11.3 優化 Core Web Vitals
  - 改善 LCP（Largest Contentful Paint）
  - 優化 FID（First Input Delay）
  - 減少 CLS（Cumulative Layout Shift）
  - 使用 Lighthouse 持續監控
  - _Requirements: 5.1, 5.2, 5.3_

### 12. 後端整合準備

- [ ] 12.1 設計 API 架構
  - 定義 RESTful API 端點
  - 設計資料模型和關聯
  - 規劃認證和授權機制
  - 建立 API 文件
  - _Requirements: 7.1, 7.2_

- [ ] 12.2 實作 API 客戶端層
  - 建立 API 服務模組
  - 實作錯誤處理和重試邏輯
  - 加入請求快取機制
  - 整合 React Query 或 SWR
  - _Requirements: 7.1, 7.2, 7.3_

- [ ] 12.3 建立使用者認證系統
  - 實作登入/註冊 UI
  - 整合 JWT 或 OAuth
  - 實作受保護路由
  - 加入使用者個人資料管理
  - _Requirements: 7.1_

## 維護任務

### 定期維護

- [ ] M1. 更新補助資料
  - 檢查政府機關網站最新資訊
  - 更新 grants-database.json
  - 驗證資料格式正確性
  - 測試篩選和搜尋功能
  - _Requirements: 7.2, 7.3_

- [ ] M2. 檢查外部連結
  - 驗證參考資料連結有效性
  - 更新失效連結
  - 記錄連結變更
  - _Requirements: 3.3_

- [ ] M3. 依賴套件更新
  - 檢查過時的 npm 套件
  - 更新次要版本
  - 測試更新後的功能
  - 處理破壞性變更
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] M4. 效能監控
  - 檢查 Lighthouse 分數
  - 監控載入時間
  - 分析使用者回饋
  - 優化瓶頸
  - _Requirements: 5.1, 5.2, 5.3_

## 注意事項

- 標記 `*` 的任務為選擇性任務，可依專案需求決定是否執行
- 每個任務都應該在獨立的分支上開發
- 完成任務後應進行程式碼審查
- 確保所有變更都有適當的測試覆蓋
- 更新相關文件以反映變更
